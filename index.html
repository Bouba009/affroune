<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¹ÙØ±ÙˆÙ† Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† - El Affroun Online</title>
    <meta name="description" content="Ù…Ù†ØµØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙˆØ¨Ø© ÙÙŠ Ø§Ù„Ø¹ÙØ±ÙˆÙ† - Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ø§Ù„Ø³ÙŠØ§Ø±Ø§ØªØŒ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§ØªØŒ Ø§Ù„Ù‡ÙˆØ§ØªÙ ÙˆØ§Ù„Ù…Ø²ÙŠØ¯">
    <link rel="icon" type="image/png" href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjbOPPWZ_6FVtNvqp4-S8RbzejyQt75-0jLytLFSUotGJn21nup8dvMv_qdHK8t3Aapqj6PmZwFQ2HuQtI4pt4lK-cTnKAWzwoqZAXya8dxmXJ0xpE14binYHeEMdacOXNiQkAl69t1fv4Yp6XsjLsGEIUUcrxs8JK43E1QhQRsAyf3GTWuZPZ-zYpcOBU/s320/Picsart_26-02-09_09-40-35-888.png">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage-compat.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        * {
            font-family: 'Cairo', sans-serif;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        *::-webkit-scrollbar { display: none; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-100%); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(100%); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out; }
        .animate-slideIn { animation: slideIn 0.3s ease-out; }
        .animate-slideUp { animation: slideUp 0.3s ease-out; }
        .animate-pulse-slow { animation: pulse 2s infinite; }
        .animate-float { animation: float 3s ease-in-out infinite; }
        .animate-spin { animation: spin 1s linear infinite; }
        
        .gradient-blue { background: linear-gradient(135deg, #1a73e8 0%, #0d47a1 100%); }
        .gradient-orange { background: linear-gradient(135deg, #ff6d00 0%, #ff9100 100%); }
        .gradient-green { background: linear-gradient(135deg, #00c853 0%, #00e676 100%); }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .floating-btn {
            transition: all 0.3s ease;
            opacity: 0.6;
        }
        .floating-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #1a73e8 0%, #0d47a1 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(26, 115, 232, 0.3);
        }
        
        .toast {
            animation: slideIn 0.3s ease-out;
        }
        
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        
        .category-card {
            transition: all 0.3s ease;
        }
        .category-card:hover {
            transform: scale(1.05);
        }
        
        .slider-dot {
            transition: all 0.3s ease;
        }
        .slider-dot.active {
            width: 24px;
            border-radius: 4px;
        }
        
        .message-bubble {
            border-radius: 18px;
            max-width: 80%;
        }
        .message-sent {
            background: linear-gradient(135deg, #1a73e8 0%, #0d47a1 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }
        .message-received {
            background: #f0f0f0;
            color: #333;
            border-bottom-left-radius: 4px;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="app"></div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAaXp-gUOQ_G2s-kM8JhaqW8TJcJ4Nqcuo",
            authDomain: "comondi-fae4b.firebaseapp.com",
            projectId: "comondi-fae4b",
            storageBucket: "comondi-fae4b.firebasestorage.app",
            messagingSenderId: "932777870241",
            appId: "1:932777870241:web:78b0cf3a3cf14046be01e0",
            measurementId: "G-M09RX0V18S"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // App State
        let state = {
            user: null,
            currentPage: 'home',
            ads: [],
            sliders: [],
            banners: [],
            messages: [],
            notifications: [],
            categories: [
                { id: 'cars', name: 'Ø³ÙŠØ§Ø±Ø§Øª ÙˆÙ…Ø±ÙƒØ¨Ø§Øª', nameFr: 'VÃ©hicules', image: 'https://images.unsplash.com/photo-1549924231-f129b911e442?w=200&h=200&fit=crop' },
                { id: 'realestate', name: 'Ø¹Ù‚Ø§Ø±Ø§Øª', nameFr: 'Immobilier', image: 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=200&h=200&fit=crop' },
                { id: 'phones', name: 'Ù‡ÙˆØ§ØªÙ ÙˆØ¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª', nameFr: 'TÃ©lÃ©phones', image: 'https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=200&h=200&fit=crop' },
                { id: 'jobs', name: 'ÙØ±Øµ Ø¹Ù…Ù„', nameFr: 'Emploi', image: 'https://images.unsplash.com/photo-1521737711867-e3b97375f902?w=200&h=200&fit=crop' },
                { id: 'services', name: 'Ø®Ø¯Ù…Ø§Øª', nameFr: 'Services', image: 'https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=200&h=200&fit=crop' },
                { id: 'electronics', name: 'Ø£Ø¬Ù‡Ø²Ø© ÙƒÙ‡Ø±ÙˆÙ…Ù†Ø²Ù„ÙŠØ©', nameFr: 'Ã‰lectromÃ©nager', image: 'https://images.unsplash.com/photo-1574269909862-7e1d70bb8078?w=200&h=200&fit=crop' },
                { id: 'fashion', name: 'Ø£Ù„Ø¨Ø³Ø© ÙˆÙ…ÙˆØ¶Ø©', nameFr: 'Mode', image: 'https://images.unsplash.com/photo-1445205170230-053b83016050?w=200&h=200&fit=crop' },
                { id: 'equipment', name: 'Ù…Ø¹Ø¯Ø§Øª Ù…Ù‡Ù†ÙŠØ©', nameFr: 'Ã‰quipement Pro', image: 'https://images.unsplash.com/photo-1504917595217-d4dc5ebb6571?w=200&h=200&fit=crop' },
                { id: 'sweets', name: 'Ø­Ù„ÙˆÙŠØ§Øª', nameFr: 'PÃ¢tisseries', image: 'https://images.unsplash.com/photo-1551024601-bec78aea704b?w=200&h=200&fit=crop' },
                { id: 'sewing', name: 'Ø®ÙŠØ§Ø·Ø©', nameFr: 'Couture', image: 'https://images.unsplash.com/photo-1558171813-4c088753af8f?w=200&h=200&fit=crop' },
                { id: 'beauty', name: 'ØªØ¬Ù…ÙŠÙ„ ÙˆØ¹Ù†Ø§ÙŠØ©', nameFr: 'BeautÃ©', image: 'https://images.unsplash.com/photo-1596462502278-27bfdc403348?w=200&h=200&fit=crop' },
                { id: 'other', name: 'Ø£Ø®Ø±Ù‰', nameFr: 'Autres', image: 'https://images.unsplash.com/photo-1586953208270-767889fa9b8f?w=200&h=200&fit=crop' }
            ],
            cities: ['Ø§Ù„Ø¹ÙØ±ÙˆÙ†', 'Ù…ÙˆØ²Ø§ÙŠØ©', 'Ø´ÙØ©', 'ÙˆØ§Ø¯ Ø¬Ø±', 'Ø£Ø­Ù…Ø± Ø§Ù„Ø¹ÙŠÙ†', 'Ø­Ø·Ø§Ø·Ø¨Ø©'],
            lang: 'ar',
            selectedAd: null,
            selectedCategory: '',
            selectedCity: '',
            minPrice: '',
            maxPrice: '',
            searchQuery: '',
            showAuthModal: false,
            showAddAdModal: false,
            showFilterModal: false,
            showSearchModal: false,
            showSideMenu: false,
            showMessageModal: false,
            showProfileEdit: false,
            authMode: 'login',
            selectedProfile: null,
            currentSlide: 0,
            currentCategorySlide: 0,
            messageToSeller: null
        };

        // Utility Functions
        function t(ar, fr) {
            return state.lang === 'ar' ? ar : fr;
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast fixed top-4 right-4 z-50 px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 ${
                type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            } text-white`;
            toast.innerHTML = `
                <span class="text-2xl">${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}</span>
                <span class="font-medium">${message}</span>
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function formatDate(timestamp) {
            if (!timestamp) return '';
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            return date.toLocaleDateString('ar-DZ');
        }

        function formatPrice(price) {
            return new Intl.NumberFormat('ar-DZ').format(price) + ' Ø¯.Ø¬';
        }

        // Auth Functions
        async function handleLogin(email, password) {
            try {
                await auth.signInWithEmailAndPassword(email, password);
                showToast(t('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'Connexion rÃ©ussie'));
                state.showAuthModal = false;
                render();
            } catch (error) {
                showToast(t('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'Email ou mot de passe incorrect'), 'error');
            }
        }

        async function handleRegister(name, email, phone, password) {
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                await db.collection('users').doc(userCredential.user.uid).set({
                    name,
                    email,
                    phone,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    isActive: true
                });
                showToast(t('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'Compte crÃ©Ã© avec succÃ¨s'));
                state.showAuthModal = false;
                render();
            } catch (error) {
                showToast(t('Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'Erreur, rÃ©essayez'), 'error');
            }
        }

        function handleLogout() {
            auth.signOut();
            state.user = null;
            showToast(t('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'DÃ©connexion rÃ©ussie'));
            render();
        }

        // Firestore Functions
        async function loadAds() {
            try {
                const snapshot = await db.collection('ads').where('isActive', '==', true).orderBy('createdAt', 'desc').get();
                state.ads = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                render();
            } catch (error) {
                console.log('Loading ads error:', error);
            }
        }

        async function loadSliders() {
            try {
                const snapshot = await db.collection('sliders').where('isActive', '==', true).get();
                state.sliders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                render();
            } catch (error) {
                console.log('Loading sliders error:', error);
            }
        }

        async function loadBanners() {
            try {
                const snapshot = await db.collection('banners').where('isActive', '==', true).get();
                state.banners = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                render();
            } catch (error) {
                console.log('Loading banners error:', error);
            }
        }

        async function loadMessages() {
            if (!state.user) return;
            try {
                const snapshot = await db.collection('messages')
                    .where('toUserId', '==', state.user.oderId)
                    .orderBy('createdAt', 'desc')
                    .get();
                state.messages = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                render();
            } catch (error) {
                console.log('Loading messages error:', error);
            }
        }

        async function addAd(adData) {
            try {
                await db.collection('ads').add({
                    ...adData,
                    userId: state.user.uid,
                    userName: state.user.displayName || state.user.email.split('@')[0],
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    isActive: true,
                    isFeatured: false,
                    views: 0
                });
                showToast(t('ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­', 'Annonce publiÃ©e avec succÃ¨s'));
                state.showAddAdModal = false;
                loadAds();
            } catch (error) {
                showToast(t('Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'Erreur, rÃ©essayez'), 'error');
            }
        }

        async function sendMessage(toUserId, adId, message) {
            if (!state.user) {
                state.showAuthModal = true;
                render();
                return;
            }
            try {
                await db.collection('messages').add({
                    fromUserId: state.user.uid,
                    fromUserName: state.user.displayName || state.user.email.split('@')[0],
                    toUserId,
                    adId,
                    message,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    isRead: false
                });
                showToast(t('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'Message envoyÃ©'));
                state.showMessageModal = false;
                render();
            } catch (error) {
                showToast(t('Ø­Ø¯Ø« Ø®Ø·Ø£', 'Erreur'), 'error');
            }
        }

        async function reportAd(adId, reason) {
            if (!state.user) {
                state.showAuthModal = true;
                render();
                return;
            }
            try {
                await db.collection('reports').add({
                    adId,
                    userId: state.user.uid,
                    reason,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                showToast(t('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº', 'Signalement envoyÃ©'));
            } catch (error) {
                showToast(t('Ø­Ø¯Ø« Ø®Ø·Ø£', 'Erreur'), 'error');
            }
        }

        // Filter Functions
        function getFilteredAds() {
            let filtered = [...state.ads];
            
            if (state.selectedCategory) {
                filtered = filtered.filter(ad => ad.category === state.selectedCategory);
            }
            if (state.selectedCity) {
                filtered = filtered.filter(ad => ad.city === state.selectedCity);
            }
            if (state.minPrice) {
                filtered = filtered.filter(ad => Number(ad.price) >= Number(state.minPrice));
            }
            if (state.maxPrice) {
                filtered = filtered.filter(ad => Number(ad.price) <= Number(state.maxPrice));
            }
            if (state.searchQuery) {
                const query = state.searchQuery.toLowerCase();
                filtered = filtered.filter(ad => 
                    ad.title?.toLowerCase().includes(query) || 
                    ad.description?.toLowerCase().includes(query)
                );
            }
            
            // Sort featured first
            filtered.sort((a, b) => (b.isFeatured ? 1 : 0) - (a.isFeatured ? 1 : 0));
            
            return filtered;
        }

        // Render Functions
        function renderHeader() {
            return `
                <header class="gradient-blue text-white sticky top-0 z-40 shadow-lg">
                    <div class="container mx-auto px-4">
                        <div class="flex items-center justify-between h-16">
                            <!-- Menu Button -->
                            <button onclick="state.showSideMenu = true; render();" class="p-2 hover:bg-white/20 rounded-lg transition">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                                </svg>
                            </button>
                            
                            <!-- Logo -->
                            <div onclick="goHome()" class="cursor-pointer flex items-center gap-2">
                                <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjbOPPWZ_6FVtNvqp4-S8RbzejyQt75-0jLytLFSUotGJn21nup8dvMv_qdHK8t3Aapqj6PmZwFQ2HuQtI4pt4lK-cTnKAWzwoqZAXya8dxmXJ0xpE14binYHeEMdacOXNiQkAl69t1fv4Yp6XsjLsGEIUUcrxs8JK43E1QhQRsAyf3GTWuZPZ-zYpcOBU/s320/Picsart_26-02-09_09-40-35-888.png" 
                                     alt="Logo" class="h-12 md:h-14 rounded-lg">
                            </div>
                            
                            <!-- Right Actions -->
                            <div class="flex items-center gap-2">
                                <!-- Language Toggle -->
                                <button onclick="state.lang = state.lang === 'ar' ? 'fr' : 'ar'; document.documentElement.dir = state.lang === 'ar' ? 'rtl' : 'ltr'; render();" 
                                        class="p-2 hover:bg-white/20 rounded-lg transition text-sm font-bold">
                                    ${state.lang === 'ar' ? 'FR' : 'Ø¹Ø±Ø¨ÙŠ'}
                                </button>
                                
                                ${state.user ? `
                                    <!-- Notifications -->
                                    <button onclick="state.currentPage = 'messages'; render();" class="p-2 hover:bg-white/20 rounded-lg transition relative">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                                        </svg>
                                        ${state.messages.filter(m => !m.isRead).length > 0 ? `
                                            <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">
                                                ${state.messages.filter(m => !m.isRead).length}
                                            </span>
                                        ` : ''}
                                    </button>
                                    
                                    <!-- User Menu -->
                                    <div class="relative group">
                                        <button class="flex items-center gap-2 p-2 hover:bg-white/20 rounded-lg transition">
                                            <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
                                                ${(state.user.displayName || state.user.email)[0].toUpperCase()}
                                            </div>
                                        </button>
                                        <div class="absolute left-0 top-full mt-2 bg-white rounded-xl shadow-xl py-2 min-w-48 hidden group-hover:block z-50">
                                            <div class="px-4 py-2 border-b text-gray-700">
                                                <p class="font-bold">${state.user.displayName || state.user.email.split('@')[0]}</p>
                                                <p class="text-sm text-gray-500">${state.user.email}</p>
                                            </div>
                                            <button onclick="state.currentPage = 'myads'; render();" class="w-full px-4 py-2 text-right hover:bg-gray-100 text-gray-700 flex items-center gap-2">
                                                ğŸ“‹ ${t('Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙŠ', 'Mes annonces')}
                                            </button>
                                            <button onclick="state.currentPage = 'messages'; render();" class="w-full px-4 py-2 text-right hover:bg-gray-100 text-gray-700 flex items-center gap-2">
                                                ğŸ’¬ ${t('Ø§Ù„Ø±Ø³Ø§Ø¦Ù„', 'Messages')}
                                            </button>
                                            <button onclick="state.showProfileEdit = true; render();" class="w-full px-4 py-2 text-right hover:bg-gray-100 text-gray-700 flex items-center gap-2">
                                                âš™ï¸ ${t('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù', 'Modifier profil')}
                                            </button>
                                            <button onclick="handleLogout()" class="w-full px-4 py-2 text-right hover:bg-gray-100 text-red-600 flex items-center gap-2">
                                                ğŸšª ${t('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'DÃ©connexion')}
                                            </button>
                                        </div>
                                    </div>
                                ` : `
                                    <button onclick="state.showAuthModal = true; state.authMode = 'login'; render();" 
                                            class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition font-medium">
                                        ${t('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'Connexion')}
                                    </button>
                                `}
                            </div>
                        </div>
                    </div>
                </header>
            `;
        }

        function renderSlider() {
            const defaultSlides = [
                { title: 'ğŸ‰ Ø¹Ø±ÙˆØ¶ Ø®Ø§ØµØ©', description: 'Ø§ÙƒØªØ´Ù Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙÙŠ Ø§Ù„Ø¹ÙØ±ÙˆÙ†', image: 'https://images.unsplash.com/photo-1607082348824-0a96f2a4b9da?w=1200&h=500&fit=crop', color: 'from-blue-600 to-purple-600' },
                { title: 'ğŸ  Ø¹Ù‚Ø§Ø±Ø§Øª Ù„Ù„Ø¨ÙŠØ¹', description: 'Ø´Ù‚Ù‚ ÙˆÙÙŠÙ„Ø§Øª Ø¨Ø£Ø³Ø¹Ø§Ø± Ù…Ù†Ø§Ø³Ø¨Ø©', image: 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=1200&h=500&fit=crop', color: 'from-green-600 to-teal-600' },
                { title: 'ğŸš— Ø³ÙŠØ§Ø±Ø§Øª Ù…Ù…ÙŠØ²Ø©', description: 'Ø£ÙØ¶Ù„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„Ø©', image: 'https://images.unsplash.com/photo-1549924231-f129b911e442?w=1200&h=500&fit=crop', color: 'from-orange-600 to-red-600' },
                { title: 'ğŸ“± Ù‡ÙˆØ§ØªÙ ÙˆØ¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª', description: 'Ø£Ø­Ø¯Ø« Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø¨Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±', image: 'https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=1200&h=500&fit=crop', color: 'from-purple-600 to-pink-600' }
            ];
            
            const slides = state.sliders.length > 0 ? state.sliders : defaultSlides;
            const current = slides[state.currentSlide % slides.length];
            
            return `
                <div class="relative h-64 md:h-96 overflow-hidden">
                    <div class="absolute inset-0 bg-cover bg-center transition-all duration-500" 
                         style="background-image: url('${current.image}')">
                        <div class="absolute inset-0 bg-gradient-to-r ${current.color || 'from-blue-600/80 to-purple-600/80'}"></div>
                    </div>
                    <div class="relative h-full flex items-center justify-center text-center text-white px-4">
                        <div class="animate-fadeIn">
                            <h2 class="text-3xl md:text-5xl font-bold mb-4 drop-shadow-lg">${current.title}</h2>
                            <p class="text-lg md:text-xl mb-6 drop-shadow">${current.description}</p>
                            <button onclick="state.currentPage = 'ads'; render();" 
                                    class="px-8 py-3 bg-white text-blue-600 rounded-full font-bold hover:bg-gray-100 transition shadow-xl">
                                ${t('ØªØµÙØ­ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª', 'Parcourir')} â†’
                            </button>
                        </div>
                    </div>
                    
                    <!-- Navigation Arrows -->
                    <button onclick="prevSlide()" class="absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/30 hover:bg-white/50 rounded-full flex items-center justify-center text-white transition">
                        â†
                    </button>
                    <button onclick="nextSlide()" class="absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/30 hover:bg-white/50 rounded-full flex items-center justify-center text-white transition">
                        â†’
                    </button>
                    
                    <!-- Dots -->
                    <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2">
                        ${slides.map((_, i) => `
                            <button onclick="state.currentSlide = ${i}; render();" 
                                    class="slider-dot w-3 h-3 rounded-full ${i === state.currentSlide % slides.length ? 'bg-white active' : 'bg-white/50'}"></button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderCategories() {
            const itemsPerSlide = 4;
            const totalSlides = Math.ceil(state.categories.length / itemsPerSlide);
            const startIndex = (state.currentCategorySlide % totalSlides) * itemsPerSlide;
            const currentCategories = state.categories.slice(startIndex, startIndex + itemsPerSlide);
            
            return `
                <section class="py-8 bg-white">
                    <div class="container mx-auto px-4">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">${t('Ø§Ù„ÙØ¦Ø§Øª', 'CatÃ©gories')}</h2>
                        <div class="relative">
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                ${currentCategories.map(cat => `
                                    <div onclick="state.selectedCategory = '${cat.id}'; state.currentPage = 'ads'; render();" 
                                         class="category-card cursor-pointer text-center p-4 rounded-xl bg-gray-50 hover:bg-blue-50 transition">
                                        <div class="w-20 h-20 mx-auto mb-3 rounded-full overflow-hidden shadow-lg border-4 border-white">
                                            <img src="${cat.image}" alt="${cat.name}" class="w-full h-full object-cover">
                                        </div>
                                        <h3 class="font-bold text-gray-800">${state.lang === 'ar' ? cat.name : cat.nameFr}</h3>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <!-- Navigation -->
                            <button onclick="prevCategorySlide()" class="absolute -left-2 top-1/2 -translate-y-1/2 w-10 h-10 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 transition flex items-center justify-center">
                                â†
                            </button>
                            <button onclick="nextCategorySlide()" class="absolute -right-2 top-1/2 -translate-y-1/2 w-10 h-10 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 transition flex items-center justify-center">
                                â†’
                            </button>
                        </div>
                        
                        <!-- Dots -->
                        <div class="flex justify-center gap-2 mt-4">
                            ${Array(totalSlides).fill(0).map((_, i) => `
                                <button onclick="state.currentCategorySlide = ${i}; render();" 
                                        class="w-2 h-2 rounded-full ${i === state.currentCategorySlide % totalSlides ? 'bg-blue-600' : 'bg-gray-300'}"></button>
                            `).join('')}
                        </div>
                    </div>
                </section>
            `;
        }

        function renderAdCard(ad) {
            const cat = state.categories.find(c => c.id === ad.category);
            return `
                <div class="card-hover bg-white rounded-xl overflow-hidden shadow-md ${ad.isFeatured ? 'ring-2 ring-yellow-400' : ''}">
                    ${ad.isFeatured ? '<div class="bg-yellow-400 text-yellow-900 text-center text-sm py-1 font-bold">â­ ${t("Ø¥Ø¹Ù„Ø§Ù† Ù…Ù…ÙŠØ²", "Annonce Premium")}</div>' : ''}
                    <div class="relative">
                        <img src="${ad.image || 'https://via.placeholder.com/300x200?text=No+Image'}" 
                             alt="${ad.title}" 
                             class="w-full h-48 object-cover cursor-pointer"
                             onclick="openAd('${ad.id}')">
                        <button onclick="event.stopPropagation(); reportAdPrompt('${ad.id}')" 
                                class="absolute top-2 left-2 p-2 bg-white/80 hover:bg-white rounded-full text-red-500 transition">
                            ğŸš©
                        </button>
                    </div>
                    <div class="p-4">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs">
                                ${cat ? (state.lang === 'ar' ? cat.name : cat.nameFr) : ad.category}
                            </span>
                            <span class="text-gray-500 text-xs">ğŸ“ ${ad.city}</span>
                        </div>
                        <h3 onclick="openAd('${ad.id}')" class="font-bold text-gray-800 mb-2 cursor-pointer hover:text-blue-600 line-clamp-2">${ad.title}</h3>
                        <p class="text-2xl font-bold text-blue-600 mb-3">${formatPrice(ad.price)}</p>
                        <div class="flex items-center justify-between">
                            <span onclick="openProfile('${ad.userId}')" class="text-sm text-gray-500 cursor-pointer hover:text-blue-600">
                                ğŸ‘¤ ${ad.userName}
                            </span>
                            ${state.user && state.user.uid !== ad.userId ? `
                                <button onclick="event.stopPropagation(); openMessageModal('${ad.userId}', '${ad.id}', '${ad.title}')" 
                                        class="p-2 bg-green-500 hover:bg-green-600 text-white rounded-full transition">
                                    ğŸ’¬
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAdsGrid() {
            const filteredAds = getFilteredAds();
            return `
                <section class="py-8">
                    <div class="container mx-auto px-4">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">${t('Ø£Ø­Ø¯Ø« Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª', 'DerniÃ¨res annonces')}</h2>
                        ${filteredAds.length > 0 ? `
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                                ${filteredAds.slice(0, 12).map(ad => renderAdCard(ad)).join('')}
                            </div>
                            ${filteredAds.length > 12 ? `
                                <div class="text-center mt-8">
                                    <button onclick="state.currentPage = 'ads'; render();" class="btn-primary px-8 py-3 text-white rounded-full font-bold">
                                        ${t('Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯', 'Voir plus')} â†’
                                    </button>
                                </div>
                            ` : ''}
                        ` : `
                            <div class="text-center py-16 text-gray-500">
                                <p class="text-6xl mb-4">ğŸ“­</p>
                                <p class="text-xl">${t('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹', 'Aucune annonce pour le moment')}</p>
                            </div>
                        `}
                    </div>
                </section>
            `;
        }

        function renderAdDetail() {
            const ad = state.ads.find(a => a.id === state.selectedAd);
            if (!ad) return '<div class="p-8 text-center">${t("Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯", "Annonce introuvable")}</div>';
            
            const cat = state.categories.find(c => c.id === ad.category);
            
            return `
                <div class="container mx-auto px-4 py-8 animate-fadeIn">
                    <button onclick="goBack()" class="mb-4 flex items-center gap-2 text-blue-600 hover:text-blue-800">
                        â† ${t('Ø±Ø¬ÙˆØ¹', 'Retour')}
                    </button>
                    
                    <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
                        <div class="md:flex">
                            <div class="md:w-1/2">
                                <img src="${ad.image || 'https://via.placeholder.com/600x400'}" alt="${ad.title}" class="w-full h-80 md:h-full object-cover">
                            </div>
                            <div class="md:w-1/2 p-6 md:p-8">
                                ${ad.isFeatured ? '<div class="inline-block bg-yellow-400 text-yellow-900 px-3 py-1 rounded-full text-sm font-bold mb-4">â­ ${t("Ø¥Ø¹Ù„Ø§Ù† Ù…Ù…ÙŠØ²", "Premium")}</div>' : ''}
                                
                                <div class="flex items-center gap-2 mb-4">
                                    <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">
                                        ${cat ? (state.lang === 'ar' ? cat.name : cat.nameFr) : ad.category}
                                    </span>
                                    <span class="text-gray-500">ğŸ“ ${ad.city}</span>
                                </div>
                                
                                <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-4">${ad.title}</h1>
                                <p class="text-3xl font-bold text-blue-600 mb-6">${formatPrice(ad.price)}</p>
                                
                                <div class="bg-gray-50 rounded-xl p-4 mb-6">
                                    <h3 class="font-bold text-gray-700 mb-2">${t('Ø§Ù„ÙˆØµÙ', 'Description')}</h3>
                                    <p class="text-gray-600 whitespace-pre-line">${ad.description}</p>
                                </div>
                                
                                <div class="flex items-center gap-4 mb-6 p-4 bg-gray-50 rounded-xl">
                                    <div onclick="openProfile('${ad.userId}')" class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold text-xl cursor-pointer">
                                        ${(ad.userName || 'U')[0].toUpperCase()}
                                    </div>
                                    <div>
                                        <p onclick="openProfile('${ad.userId}')" class="font-bold text-gray-800 cursor-pointer hover:text-blue-600">${ad.userName}</p>
                                        <p class="text-sm text-gray-500">${formatDate(ad.createdAt)}</p>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-4 mb-6">
                                    <button onclick="showPhone('${ad.phone}')" 
                                            class="gradient-green text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:opacity-90 transition shadow-lg">
                                        <span class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">ğŸ“</span>
                                        ${t('Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‡Ø§ØªÙ', 'Afficher tÃ©l')}
                                    </button>
                                    <button onclick="openMessageModal('${ad.userId}', '${ad.id}', '${ad.title}')" 
                                            class="gradient-blue text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:opacity-90 transition shadow-lg">
                                        <span class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">ğŸ’¬</span>
                                        ${t('Ù…Ø±Ø§Ø³Ù„Ø©', 'Message')}
                                    </button>
                                </div>
                                
                                <button onclick="reportAdPrompt('${ad.id}')" 
                                        class="w-full py-3 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-xl transition flex items-center justify-center gap-2">
                                    ğŸš© ${t('Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'Signaler cette annonce')}
                                </button>
                                
                                <div class="mt-4 p-3 bg-blue-50 rounded-xl flex items-center justify-between">
                                    <span class="text-sm text-gray-600">${t('Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©', 'Lien de partage')}</span>
                                    <button onclick="copyLink('${ad.id}')" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 transition">
                                        ğŸ“‹ ${t('Ù†Ø³Ø®', 'Copier')}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAdsPage() {
            const filteredAds = getFilteredAds();
            
            return `
                <div class="container mx-auto px-4 py-8 animate-fadeIn">
                    <!-- Filters Bar -->
                    <div class="bg-white rounded-xl shadow-md p-4 mb-6">
                        <div class="flex flex-wrap items-center gap-4">
                            <select onchange="state.selectedCategory = this.value; render();" class="px-4 py-2 border rounded-lg">
                                <option value="">${t('Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª', 'Toutes catÃ©gories')}</option>
                                ${state.categories.map(cat => `
                                    <option value="${cat.id}" ${state.selectedCategory === cat.id ? 'selected' : ''}>
                                        ${state.lang === 'ar' ? cat.name : cat.nameFr}
                                    </option>
                                `).join('')}
                            </select>
                            
                            <select onchange="state.selectedCity = this.value; render();" class="px-4 py-2 border rounded-lg">
                                <option value="">${t('Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯Ù†', 'Toutes villes')}</option>
                                ${state.cities.map(city => `
                                    <option value="${city}" ${state.selectedCity === city ? 'selected' : ''}>${city}</option>
                                `).join('')}
                            </select>
                            
                            <div class="flex items-center gap-2">
                                <input type="number" placeholder="${t('Ø£Ø¯Ù†Ù‰ Ø³Ø¹Ø±', 'Prix min')}" 
                                       value="${state.minPrice}" 
                                       onchange="state.minPrice = this.value; render();"
                                       class="w-24 px-3 py-2 border rounded-lg">
                                <span>-</span>
                                <input type="number" placeholder="${t('Ø£Ù‚ØµÙ‰ Ø³Ø¹Ø±', 'Prix max')}" 
                                       value="${state.maxPrice}" 
                                       onchange="state.maxPrice = this.value; render();"
                                       class="w-24 px-3 py-2 border rounded-lg">
                            </div>
                            
                            <button onclick="clearFilters()" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg transition">
                                ${t('Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±', 'Effacer')}
                            </button>
                        </div>
                    </div>
                    
                    <!-- Results Count -->
                    <p class="text-gray-600 mb-4">${filteredAds.length} ${t('Ø¥Ø¹Ù„Ø§Ù†', 'annonces')}</p>
                    
                    <!-- Ads Grid -->
                    ${filteredAds.length > 0 ? `
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                            ${filteredAds.map(ad => renderAdCard(ad)).join('')}
                        </div>
                    ` : `
                        <div class="text-center py-16 text-gray-500">
                            <p class="text-6xl mb-4">ğŸ”</p>
                            <p class="text-xl">${t('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬', 'Aucun rÃ©sultat')}</p>
                        </div>
                    `}
                </div>
            `;
        }

        function renderMessagesPage() {
            return `
                <div class="container mx-auto px-4 py-8 animate-fadeIn">
                    <h1 class="text-2xl font-bold text-gray-800 mb-6">${t('Ø§Ù„Ø±Ø³Ø§Ø¦Ù„', 'Messages')}</h1>
                    
                    ${state.messages.length > 0 ? `
                        <div class="space-y-4">
                            ${state.messages.map(msg => `
                                <div class="bg-white rounded-xl shadow-md p-4 ${!msg.isRead ? 'border-l-4 border-blue-500' : ''}">
                                    <div class="flex items-center gap-4 mb-3">
                                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold">
                                            ${(msg.fromUserName || 'U')[0].toUpperCase()}
                                        </div>
                                        <div class="flex-1">
                                            <p class="font-bold text-gray-800">${msg.fromUserName}</p>
                                            <p class="text-sm text-gray-500">${formatDate(msg.createdAt)}</p>
                                        </div>
                                        ${!msg.isRead ? '<span class="px-2 py-1 bg-blue-100 text-blue-600 text-xs rounded-full">${t("Ø¬Ø¯ÙŠØ¯", "Nouveau")}</span>' : ''}
                                    </div>
                                    <p class="text-gray-600 mb-3">${msg.message}</p>
                                    <div class="flex gap-2">
                                        <button onclick="openMessageModal('${msg.fromUserId}', '', '${t("Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø©", "RÃ©pondre")}')" 
                                                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm transition">
                                            ${t('Ø±Ø¯', 'RÃ©pondre')}
                                        </button>
                                        ${!msg.isRead ? `
                                            <button onclick="markAsRead('${msg.id}')" 
                                                    class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg text-sm transition">
                                                ${t('ØªÙ… Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©', 'Marquer lu')}
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="text-center py-16 text-gray-500">
                            <p class="text-6xl mb-4">ğŸ“­</p>
                            <p class="text-xl">${t('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„', 'Aucun message')}</p>
                        </div>
                    `}
                </div>
            `;
        }

        function renderProfilePage() {
            const userAds = state.ads.filter(ad => ad.userId === state.selectedProfile);
            
            return `
                <div class="container mx-auto px-4 py-8 animate-fadeIn">
                    <button onclick="goBack()" class="mb-4 flex items-center gap-2 text-blue-600 hover:text-blue-800">
                        â† ${t('Ø±Ø¬ÙˆØ¹', 'Retour')}
                    </button>
                    
                    <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
                        <div class="flex items-center gap-4">
                            <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold text-3xl">
                                ${userAds[0]?.userName?.[0]?.toUpperCase() || 'U'}
                            </div>
                            <div>
                                <h1 class="text-2xl font-bold text-gray-800">${userAds[0]?.userName || t('Ù…Ø³ØªØ®Ø¯Ù…', 'Utilisateur')}</h1>
                                <p class="text-gray-500">${userAds.length} ${t('Ø¥Ø¹Ù„Ø§Ù†', 'annonces')}</p>
                            </div>
                        </div>
                    </div>
                    
                    <h2 class="text-xl font-bold text-gray-800 mb-4">${t('Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'Annonces')}</h2>
                    
                    ${userAds.length > 0 ? `
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${userAds.map(ad => renderAdCard(ad)).join('')}
                        </div>
                    ` : `
                        <div class="text-center py-16 text-gray-500">
                            <p class="text-6xl mb-4">ğŸ“­</p>
                            <p class="text-xl">${t('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª', 'Aucune annonce')}</p>
                        </div>
                    `}
                </div>
            `;
        }

        function renderMyAdsPage() {
            const myAds = state.ads.filter(ad => ad.userId === state.user?.uid);
            
            return `
                <div class="container mx-auto px-4 py-8 animate-fadeIn">
                    <h1 class="text-2xl font-bold text-gray-800 mb-6">${t('Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙŠ', 'Mes annonces')}</h1>
                    
                    ${myAds.length > 0 ? `
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${myAds.map(ad => renderAdCard(ad)).join('')}
                        </div>
                    ` : `
                        <div class="text-center py-16 text-gray-500">
                            <p class="text-6xl mb-4">ğŸ“­</p>
                            <p class="text-xl mb-4">${t('Ù„Ù… ØªÙ†Ø´Ø± Ø£ÙŠ Ø¥Ø¹Ù„Ø§Ù† Ø¨Ø¹Ø¯', "Vous n'avez pas encore publiÃ© d'annonce")}</p>
                            <button onclick="state.showAddAdModal = true; render();" class="btn-primary px-6 py-3 text-white rounded-full font-bold">
                                + ${t('Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù†', 'Publier')}
                            </button>
                        </div>
                    `}
                </div>
            `;
        }

        function renderAboutPage() {
            return `
                <div class="container mx-auto px-4 py-8 animate-fadeIn">
                    <div class="bg-white rounded-2xl shadow-xl p-8 max-w-3xl mx-auto">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">${t('Ù…Ù† Ù†Ø­Ù†', 'Ã€ propos')}</h1>
                        <div class="prose max-w-none text-gray-600 space-y-4">
                            <p>${t(
                                'Ù…Ù†ØµØ© Ø§Ù„Ø¹ÙØ±ÙˆÙ† Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ù‡ÙŠ Ù…Ù†ØµØ© Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø¨ÙˆØ¨Ø© Ù…Ø­Ù„ÙŠØ© ØªØ®Ø¯Ù… Ø³ÙƒØ§Ù† Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹ÙØ±ÙˆÙ† ÙˆØ§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…Ø¬Ø§ÙˆØ±Ø©.',
                                "El Affroun Online est une plateforme d'annonces classÃ©es locale au service des habitants de la rÃ©gion d'El Affroun."
                            )}</p>
                            <h3 class="text-xl font-bold text-gray-800 mt-6">${t('Ù…Ù…ÙŠØ²Ø§ØªÙ†Ø§', 'Nos avantages')}</h3>
                            <ul class="list-disc pr-6 space-y-2">
                                <li>${t('Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø¬Ø§Ù†ÙŠ', 'Publication gratuite')}</li>
                                <li>${t('ØªÙˆØ§ØµÙ„ Ù…Ø¨Ø§Ø´Ø± Ù…Ø¹ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†', 'Contact direct avec les vendeurs')}</li>
                                <li>${t('ÙØ¦Ø§Øª Ù…ØªÙ†ÙˆØ¹Ø©', 'CatÃ©gories variÃ©es')}</li>
                                <li>${t('Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…', 'FacilitÃ© d\'utilisation')}</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPrivacyPage() {
            return `
                <div class="container mx-auto px-4 py-8 animate-fadeIn">
                    <div class="bg-white rounded-2xl shadow-xl p-8 max-w-3xl mx-auto">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">${t('Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©', 'Politique de confidentialitÃ©')}</h1>
                        <div class="prose max-w-none text-gray-600 space-y-4">
                            <h3 class="text-xl font-bold text-gray-800">${t('Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Collecte des donnÃ©es')}</h3>
                            <p>${t(
                                'Ù†Ù‚ÙˆÙ… Ø¨Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ© ÙÙ‚Ø· Ù„ØªÙˆÙÙŠØ± Ø®Ø¯Ù…Ø§ØªÙ†Ø§ØŒ Ù…Ø«Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ.',
                                'Nous collectons uniquement les donnÃ©es nÃ©cessaires pour fournir nos services.'
                            )}</p>
                            <h3 class="text-xl font-bold text-gray-800 mt-6">${t('Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Protection des donnÃ©es')}</h3>
                            <p>${t(
                                'Ù†Ø­Ù† Ù…Ù„ØªØ²Ù…ÙˆÙ† Ø¨Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© ÙˆÙ„Ù† Ù†Ø´Ø§Ø±ÙƒÙ‡Ø§ Ù…Ø¹ Ø£Ø·Ø±Ø§Ù Ø«Ø§Ù„Ø«Ø©.',
                                'Nous nous engageons Ã  protÃ©ger vos donnÃ©es personnelles.'
                            )}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderContactPage() {
            return `
                <div class="container mx-auto px-4 py-8 animate-fadeIn">
                    <div class="bg-white rounded-2xl shadow-xl p-8 max-w-3xl mx-auto">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">${t('Ø§ØªØµÙ„ Ø¨Ù†Ø§', 'Contactez-nous')}</h1>
                        <div class="space-y-6">
                            <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-xl">
                                <span class="text-3xl">ğŸ“§</span>
                                <div>
                                    <p class="font-bold text-gray-800">${t('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', 'Email')}</p>
                                    <p class="text-blue-600">contact@elaffroun-online.com</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-xl">
                                <span class="text-3xl">ğŸ“±</span>
                                <div>
                                    <p class="font-bold text-gray-800">${t('Ø§Ù„Ù‡Ø§ØªÙ', 'TÃ©lÃ©phone')}</p>
                                    <p class="text-blue-600">+213 XX XX XX XX</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-xl">
                                <span class="text-3xl">ğŸ“</span>
                                <div>
                                    <p class="font-bold text-gray-800">${t('Ø§Ù„Ù…ÙˆÙ‚Ø¹', 'Adresse')}</p>
                                    <p class="text-gray-600">${t('Ø§Ù„Ø¹ÙØ±ÙˆÙ†ØŒ Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©ØŒ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±', 'El Affroun, Blida, AlgÃ©rie')}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSideMenu() {
            if (!state.showSideMenu) return '';
            
            return `
                <div class="fixed inset-0 z-50">
                    <div onclick="state.showSideMenu = false; render();" class="absolute inset-0 bg-black/50"></div>
                    <div class="absolute right-0 top-0 h-full w-80 bg-white shadow-2xl animate-slideIn">
                        <div class="gradient-blue p-6">
                            <div class="flex items-center justify-between text-white">
                                <h2 class="text-xl font-bold">${t('Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©', 'Menu')}</h2>
                                <button onclick="state.showSideMenu = false; render();" class="p-2 hover:bg-white/20 rounded-lg">âœ•</button>
                            </div>
                        </div>
                        <nav class="p-4 space-y-2">
                            <button onclick="goHome()" class="w-full p-3 text-right hover:bg-gray-100 rounded-xl flex items-center gap-3 text-gray-700">
                                ğŸ  ${t('Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', 'Accueil')}
                            </button>
                            <button onclick="state.currentPage = 'ads'; state.showSideMenu = false; render();" class="w-full p-3 text-right hover:bg-gray-100 rounded-xl flex items-center gap-3 text-gray-700">
                                ğŸ“‹ ${t('Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª', 'Toutes les annonces')}
                            </button>
                            <hr class="my-4">
                            <button onclick="state.currentPage = 'about'; state.showSideMenu = false; render();" class="w-full p-3 text-right hover:bg-gray-100 rounded-xl flex items-center gap-3 text-gray-700">
                                â„¹ï¸ ${t('Ù…Ù† Ù†Ø­Ù†', 'Ã€ propos')}
                            </button>
                            <button onclick="state.currentPage = 'privacy'; state.showSideMenu = false; render();" class="w-full p-3 text-right hover:bg-gray-100 rounded-xl flex items-center gap-3 text-gray-700">
                                ğŸ”’ ${t('Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©', 'ConfidentialitÃ©')}
                            </button>
                            <button onclick="state.currentPage = 'contact'; state.showSideMenu = false; render();" class="w-full p-3 text-right hover:bg-gray-100 rounded-xl flex items-center gap-3 text-gray-700">
                                ğŸ“§ ${t('Ø§ØªØµÙ„ Ø¨Ù†Ø§', 'Contact')}
                            </button>
                            <button onclick="generalReport()" class="w-full p-3 text-right hover:bg-gray-100 rounded-xl flex items-center gap-3 text-gray-700">
                                ğŸš© ${t('Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ù…Ø´ÙƒÙ„', 'Signaler un problÃ¨me')}
                            </button>
                        </nav>
                    </div>
                </div>
            `;
        }

        function renderAuthModal() {
            if (!state.showAuthModal) return '';
            
            return `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div onclick="state.showAuthModal = false; render();" class="absolute inset-0 modal-backdrop"></div>
                    <div class="relative bg-white rounded-2xl shadow-2xl w-full max-w-md animate-slideUp overflow-hidden">
                        <div class="gradient-blue p-6 text-white text-center">
                            <h2 class="text-2xl font-bold">${state.authMode === 'login' ? t('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'Connexion') : t('Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨', 'Inscription')}</h2>
                        </div>
                        <form onsubmit="handleAuthSubmit(event)" class="p-6 space-y-4">
                            ${state.authMode === 'register' ? `
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">${t('Ø§Ù„Ø§Ø³Ù…', 'Nom')}</label>
                                    <input type="text" id="authName" required class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                            ` : ''}
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">${t('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', 'Email')}</label>
                                <input type="email" id="authEmail" required class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            ${state.authMode === 'register' ? `
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">${t('Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ', 'TÃ©lÃ©phone')}</label>
                                    <input type="tel" id="authPhone" required class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                            ` : ''}
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">${t('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'Mot de passe')}</label>
                                <input type="password" id="authPassword" required minlength="6" class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            ${state.authMode === 'register' ? `
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">${t('ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'Confirmer')}</label>
                                    <input type="password" id="authPassword2" required minlength="6" class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                            ` : ''}
                            <button type="submit" class="w-full btn-primary text-white py-4 rounded-xl font-bold">
                                ${state.authMode === 'login' ? t('Ø¯Ø®ÙˆÙ„', 'Connexion') : t('Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨', 'CrÃ©er')}
                            </button>
                        </form>
                        <div class="p-6 pt-0 text-center">
                            <button onclick="state.authMode = state.authMode === 'login' ? 'register' : 'login'; render();" class="text-blue-600 hover:underline">
                                ${state.authMode === 'login' ? t('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø£Ù†Ø´Ø¦ ÙˆØ§Ø­Ø¯Ø§Ù‹', "Pas de compte? CrÃ©ez-en un") : t('Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ', 'DÃ©jÃ  un compte? Connectez-vous')}
                            </button>
                        </div>
                        <button onclick="state.showAuthModal = false; render();" class="absolute top-4 left-4 text-white/80 hover:text-white text-2xl">âœ•</button>
                    </div>
                </div>
            `;
        }

        function renderAddAdModal() {
            if (!state.showAddAdModal) return '';
            
            return `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div onclick="state.showAddAdModal = false; render();" class="absolute inset-0 modal-backdrop"></div>
                    <div class="relative bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto animate-slideUp">
                        <div class="gradient-orange p-6 text-white text-center sticky top-0">
                            <h2 class="text-2xl font-bold">${t('Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯', 'Publier une annonce')}</h2>
                        </div>
                        <form onsubmit="handleAddAdSubmit(event)" class="p-6 space-y-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">${t('Ø§Ù„ÙØ¦Ø©', 'CatÃ©gorie')} *</label>
                                <select id="adCategory" required class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-500">
                                    <option value="">${t('Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©', 'Choisir')}</option>
                                    ${state.categories.map(cat => `
                                        <option value="${cat.id}">${state.lang === 'ar' ? cat.name : cat.nameFr}</option>
                                    `).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">${t('Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', 'Titre')} *</label>
                                <input type="text" id="adTitle" required class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">${t('Ø§Ù„ÙˆØµÙ', 'Description')} *</label>
                                <textarea id="adDescription" required rows="4" class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-500"></textarea>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">${t('Ø§Ù„Ø³Ø¹Ø± (Ø¯.Ø¬)', 'Prix (DA)')} *</label>
                                <input type="number" id="adPrice" required class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">${t('Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', 'Ville')} *</label>
                                <select id="adCity" required class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-500">
                                    <option value="">${t('Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', 'Choisir')}</option>
                                    ${state.cities.map(city => `<option value="${city}">${city}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">${t('Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ', 'TÃ©lÃ©phone')} *</label>
                                <input type="tel" id="adPhone" required class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">${t('Ø§Ù„ØµÙˆØ±Ø©', 'Image')}</label>
                                <input type="file" id="adImage" accept="image/*" onchange="previewImage(event)" class="w-full px-4 py-3 border rounded-xl">
                                <div id="imagePreview" class="mt-2"></div>
                            </div>
                            <button type="submit" id="submitAdBtn" class="w-full gradient-orange text-white py-4 rounded-xl font-bold text-lg">
                                ${t('Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'Publier')}
                            </button>
                        </form>
                        <button onclick="state.showAddAdModal = false; render();" class="absolute top-4 left-4 text-white/80 hover:text-white text-2xl">âœ•</button>
                    </div>
                </div>
            `;
        }

        function renderMessageModal() {
            if (!state.showMessageModal) return '';
            
            return `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div onclick="state.showMessageModal = false; render();" class="absolute inset-0 modal-backdrop"></div>
                    <div class="relative bg-white rounded-2xl shadow-2xl w-full max-w-md animate-slideUp">
                        <div class="gradient-green p-6 text-white text-center">
                            <h2 class="text-2xl font-bold">ğŸ’¬ ${t('Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©', 'Envoyer un message')}</h2>
                        </div>
                        <form onsubmit="handleSendMessage(event)" class="p-6 space-y-4">
                            <p class="text-gray-600 text-center">${state.messageToSeller?.adTitle || ''}</p>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">${t('Ø±Ø³Ø§Ù„ØªÙƒ', 'Votre message')}</label>
                                <textarea id="messageText" required rows="4" class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-green-500" placeholder="${t('Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...', 'Ã‰crivez votre message...')}"></textarea>
                            </div>
                            <button type="submit" class="w-full gradient-green text-white py-4 rounded-xl font-bold">
                                ${t('Ø¥Ø±Ø³Ø§Ù„', 'Envoyer')}
                            </button>
                        </form>
                        <button onclick="state.showMessageModal = false; render();" class="absolute top-4 left-4 text-white/80 hover:text-white text-2xl">âœ•</button>
                    </div>
                </div>
            `;
        }

        function renderFloatingButtons() {
            return `
                <div class="fixed bottom-6 left-6 z-40 flex flex-col gap-3">
                    <button onclick="if(!state.user) { state.showAuthModal = true; render(); } else { state.showAddAdModal = true; render(); }" 
                            class="floating-btn w-14 h-14 gradient-orange text-white rounded-full shadow-xl flex items-center justify-center text-2xl">
                        +
                    </button>
                    <button onclick="state.showFilterModal = true; render();" 
                            class="floating-btn w-14 h-14 gradient-blue text-white rounded-full shadow-xl flex items-center justify-center text-xl">
                        ğŸ”
                    </button>
                </div>
            `;
        }

        function renderFilterModal() {
            if (!state.showFilterModal) return '';
            
            return `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div onclick="state.showFilterModal = false; render();" class="absolute inset-0 modal-backdrop"></div>
                    <div class="relative bg-white rounded-2xl shadow-2xl w-full max-w-md animate-slideUp">
                        <div class="gradient-blue p-6 text-white text-center">
                            <h2 class="text-2xl font-bold">ğŸ” ${t('Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„ØªØ±Ø©', 'Recherche et filtre')}</h2>
                        </div>
                        <div class="p-6 space-y-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">${t('Ø¨Ø­Ø«', 'Recherche')}</label>
                                <input type="text" id="filterSearch" value="${state.searchQuery}" 
                                       placeholder="${t('Ø§Ø¨Ø­Ø« Ø¹Ù†...', 'Rechercher...')}"
                                       class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">${t('Ø§Ù„ÙØ¦Ø©', 'CatÃ©gorie')}</label>
                                <select id="filterCategory" class="w-full px-4 py-3 border rounded-xl">
                                    <option value="">${t('Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª', 'Toutes')}</option>
                                    ${state.categories.map(cat => `
                                        <option value="${cat.id}" ${state.selectedCategory === cat.id ? 'selected' : ''}>
                                            ${state.lang === 'ar' ? cat.name : cat.nameFr}
                                        </option>
                                    `).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">${t('Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', 'Ville')}</label>
                                <select id="filterCity" class="w-full px-4 py-3 border rounded-xl">
                                    <option value="">${t('Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯Ù†', 'Toutes')}</option>
                                    ${state.cities.map(city => `
                                        <option value="${city}" ${state.selectedCity === city ? 'selected' : ''}>${city}</option>
                                    `).join('')}
                                </select>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">${t('Ø£Ø¯Ù†Ù‰ Ø³Ø¹Ø±', 'Prix min')}</label>
                                    <input type="number" id="filterMinPrice" value="${state.minPrice}" class="w-full px-4 py-3 border rounded-xl">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">${t('Ø£Ù‚ØµÙ‰ Ø³Ø¹Ø±', 'Prix max')}</label>
                                    <input type="number" id="filterMaxPrice" value="${state.maxPrice}" class="w-full px-4 py-3 border rounded-xl">
                                </div>
                            </div>
                            <div class="flex gap-4">
                                <button onclick="applyFilters()" class="flex-1 btn-primary text-white py-3 rounded-xl font-bold">
                                    ${t('ØªØ·Ø¨ÙŠÙ‚', 'Appliquer')}
                                </button>
                                <button onclick="clearFilters(); state.showFilterModal = false; render();" class="flex-1 bg-gray-200 hover:bg-gray-300 py-3 rounded-xl font-bold">
                                    ${t('Ù…Ø³Ø­', 'Effacer')}
                                </button>
                            </div>
                        </div>
                        <button onclick="state.showFilterModal = false; render();" class="absolute top-4 left-4 text-white/80 hover:text-white text-2xl">âœ•</button>
                    </div>
                </div>
            `;
        }

        function renderFooter() {
            return `
                <footer class="bg-gray-800 text-white py-8 mt-8">
                    <div class="container mx-auto px-4">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                            <div>
                                <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjbOPPWZ_6FVtNvqp4-S8RbzejyQt75-0jLytLFSUotGJn21nup8dvMv_qdHK8t3Aapqj6PmZwFQ2HuQtI4pt4lK-cTnKAWzwoqZAXya8dxmXJ0xpE14binYHeEMdacOXNiQkAl69t1fv4Yp6XsjLsGEIUUcrxs8JK43E1QhQRsAyf3GTWuZPZ-zYpcOBU/s320/Picsart_26-02-09_09-40-35-888.png" alt="Logo" class="h-16 mb-4">
                                <p class="text-gray-400">${t('Ù…Ù†ØµØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙˆØ¨Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙÙŠ Ø§Ù„Ø¹ÙØ±ÙˆÙ†', "La premiÃ¨re plateforme d'annonces Ã  El Affroun")}</p>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold mb-4">${t('Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©', 'Liens rapides')}</h3>
                                <ul class="space-y-2 text-gray-400">
                                    <li><a href="#" onclick="goHome()" class="hover:text-white">${t('Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', 'Accueil')}</a></li>
                                    <li><a href="#" onclick="state.currentPage = 'about'; render();" class="hover:text-white">${t('Ù…Ù† Ù†Ø­Ù†', 'Ã€ propos')}</a></li>
                                    <li><a href="#" onclick="state.currentPage = 'privacy'; render();" class="hover:text-white">${t('Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©', 'ConfidentialitÃ©')}</a></li>
                                    <li><a href="#" onclick="state.currentPage = 'contact'; render();" class="hover:text-white">${t('Ø§ØªØµÙ„ Ø¨Ù†Ø§', 'Contact')}</a></li>
                                </ul>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold mb-4">${t('ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§', 'Contact')}</h3>
                                <p class="text-gray-400">ğŸ“§ contact@elaffroun-online.com</p>
                                <p class="text-gray-400">ğŸ“ ${t('Ø§Ù„Ø¹ÙØ±ÙˆÙ†ØŒ Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©', 'El Affroun, Blida')}</p>
                            </div>
                        </div>
                        <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                            <p>Â© 2025 ${t('Ø§Ù„Ø¹ÙØ±ÙˆÙ† Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†', 'El Affroun Online')}. ${t('Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©', 'Tous droits rÃ©servÃ©s')}</p>
                        </div>
                    </div>
                </footer>
            `;
        }

        function render() {
            let content = '';
            
            switch(state.currentPage) {
                case 'home':
                    content = renderSlider() + renderCategories() + renderAdsGrid();
                    break;
                case 'ads':
                    content = renderAdsPage();
                    break;
                case 'adDetail':
                    content = renderAdDetail();
                    break;
                case 'messages':
                    content = renderMessagesPage();
                    break;
                case 'profile':
                    content = renderProfilePage();
                    break;
                case 'myads':
                    content = renderMyAdsPage();
                    break;
                case 'about':
                    content = renderAboutPage();
                    break;
                case 'privacy':
                    content = renderPrivacyPage();
                    break;
                case 'contact':
                    content = renderContactPage();
                    break;
                default:
                    content = renderSlider() + renderCategories() + renderAdsGrid();
            }
            
            document.getElementById('app').innerHTML = `
                ${renderHeader()}
                <main class="min-h-screen">${content}</main>
                ${renderFooter()}
                ${renderFloatingButtons()}
                ${renderSideMenu()}
                ${renderAuthModal()}
                ${renderAddAdModal()}
                ${renderMessageModal()}
                ${renderFilterModal()}
            `;
        }

        // Event Handlers
        function goHome() {
            state.currentPage = 'home';
            state.selectedAd = null;
            state.selectedProfile = null;
            state.showSideMenu = false;
            render();
        }

        function goBack() {
            state.currentPage = 'ads';
            state.selectedAd = null;
            state.selectedProfile = null;
            render();
        }

        function openAd(adId) {
            state.selectedAd = adId;
            state.currentPage = 'adDetail';
            render();
        }

        function openProfile(userId) {
            state.selectedProfile = userId;
            state.currentPage = 'profile';
            render();
        }

        function openMessageModal(toUserId, adId, adTitle) {
            if (!state.user) {
                state.showAuthModal = true;
                render();
                return;
            }
            state.messageToSeller = { toUserId, adId, adTitle };
            state.showMessageModal = true;
            render();
        }

        function showPhone(phone) {
            if (!state.user) {
                state.showAuthModal = true;
                render();
                return;
            }
            alert(t('Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: ', 'TÃ©lÃ©phone: ') + phone);
        }

        function copyLink(adId) {
            const link = window.location.origin + window.location.pathname + '?ad=' + adId;
            navigator.clipboard.writeText(link);
            showToast(t('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·', 'Lien copiÃ©'));
        }

        function reportAdPrompt(adId) {
            if (!state.user) {
                state.showAuthModal = true;
                render();
                return;
            }
            const reason = prompt(t('Ø³Ø¨Ø¨ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº:', 'Raison du signalement:'));
            if (reason) {
                reportAd(adId, reason);
            }
        }

        function generalReport() {
            state.showSideMenu = false;
            if (!state.user) {
                state.showAuthModal = true;
                render();
                return;
            }
            const reason = prompt(t('Ø§ÙƒØªØ¨ Ù…Ø´ÙƒÙ„ØªÙƒ:', 'DÃ©crivez le problÃ¨me:'));
            if (reason) {
                db.collection('reports').add({
                    type: 'general',
                    userId: state.user.uid,
                    reason,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                showToast(t('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº', 'Signalement envoyÃ©'));
            }
        }

        async function markAsRead(msgId) {
            try {
                await db.collection('messages').doc(msgId).update({ isRead: true });
                loadMessages();
            } catch (error) {
                console.log('Error:', error);
            }
        }

        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').innerHTML = `
                        <img src="${e.target.result}" class="w-32 h-32 object-cover rounded-xl">
                    `;
                };
                reader.readAsDataURL(file);
            }
        }

        function handleAuthSubmit(event) {
            event.preventDefault();
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            
            if (state.authMode === 'login') {
                handleLogin(email, password);
            } else {
                const name = document.getElementById('authName').value;
                const phone = document.getElementById('authPhone').value;
                const password2 = document.getElementById('authPassword2').value;
                
                if (password !== password2) {
                    showToast(t('ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©', 'Mots de passe diffÃ©rents'), 'error');
                    return;
                }
                handleRegister(name, email, phone, password);
            }
        }

        async function handleAddAdSubmit(event) {
            event.preventDefault();
            
            const btn = document.getElementById('submitAdBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="animate-spin inline-block mr-2">â³</span> ' + t('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...', 'Publication...');
            
            const category = document.getElementById('adCategory').value;
            const title = document.getElementById('adTitle').value;
            const description = document.getElementById('adDescription').value;
            const price = document.getElementById('adPrice').value;
            const city = document.getElementById('adCity').value;
            const phone = document.getElementById('adPhone').value;
            const imageFile = document.getElementById('adImage').files[0];
            
            let imageUrl = 'https://via.placeholder.com/300x200?text=No+Image';
            
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = async function(e) {
                    imageUrl = e.target.result;
                    await addAd({ category, title, description, price: Number(price), city, phone, image: imageUrl });
                    btn.disabled = false;
                    btn.innerHTML = t('Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'Publier');
                };
                reader.readAsDataURL(imageFile);
            } else {
                await addAd({ category, title, description, price: Number(price), city, phone, image: imageUrl });
                btn.disabled = false;
                btn.innerHTML = t('Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'Publier');
            }
        }

        function handleSendMessage(event) {
            event.preventDefault();
            const message = document.getElementById('messageText').value;
            sendMessage(state.messageToSeller.toUserId, state.messageToSeller.adId, message);
        }

        function applyFilters() {
            state.searchQuery = document.getElementById('filterSearch').value;
            state.selectedCategory = document.getElementById('filterCategory').value;
            state.selectedCity = document.getElementById('filterCity').value;
            state.minPrice = document.getElementById('filterMinPrice').value;
            state.maxPrice = document.getElementById('filterMaxPrice').value;
            state.showFilterModal = false;
            state.currentPage = 'ads';
            render();
        }

        function clearFilters() {
            state.searchQuery = '';
            state.selectedCategory = '';
            state.selectedCity = '';
            state.minPrice = '';
            state.maxPrice = '';
            render();
        }

        function nextSlide() {
            const slides = state.sliders.length > 0 ? state.sliders : [1,2,3,4];
            state.currentSlide = (state.currentSlide + 1) % slides.length;
            render();
        }

        function prevSlide() {
            const slides = state.sliders.length > 0 ? state.sliders : [1,2,3,4];
            state.currentSlide = (state.currentSlide - 1 + slides.length) % slides.length;
            render();
        }

        function nextCategorySlide() {
            const totalSlides = Math.ceil(state.categories.length / 4);
            state.currentCategorySlide = (state.currentCategorySlide + 1) % totalSlides;
            render();
        }

        function prevCategorySlide() {
            const totalSlides = Math.ceil(state.categories.length / 4);
            state.currentCategorySlide = (state.currentCategorySlide - 1 + totalSlides) % totalSlides;
            render();
        }

        // Auto slide
        setInterval(() => {
            const slides = state.sliders.length > 0 ? state.sliders : [1,2,3,4];
            state.currentSlide = (state.currentSlide + 1) % slides.length;
            render();
        }, 3000);

        setInterval(() => {
            const totalSlides = Math.ceil(state.categories.length / 4);
            state.currentCategorySlide = (state.currentCategorySlide + 1) % totalSlides;
            render();
        }, 5000);

        // Auth State Listener
        auth.onAuthStateChanged(user => {
            state.user = user;
            if (user) {
                loadMessages();
            }
            render();
        });

        // Check URL for ad parameter
        const urlParams = new URLSearchParams(window.location.search);
        const adParam = urlParams.get('ad');
        if (adParam) {
            state.selectedAd = adParam;
            state.currentPage = 'adDetail';
        }

        // Track visit
        const today = new Date().toDateString();
        const visits = JSON.parse(localStorage.getItem('visits') || '{}');
        visits[today] = (visits[today] || 0) + 1;
        localStorage.setItem('visits', JSON.stringify(visits));

        // Initial Load
        loadAds();
        loadSliders();
        loadBanners();
        render();
    </script>
</body>
</html>
